# 拡張リンクチェッカー Chrome拡張機能 - 設計書

## 概要

このChrome拡張機能は、従来のリンクチェッカーの機能を拡張し、リンク検証を実行する前に特定のDOM要素（div、main、p等）を選択できる機能を提供します。これにより、より対象を絞った効率的なリンクチェックが可能になります。

## 主要機能

### 1. 要素選択モード
- **ビジュアル要素セレクター**: ホバー時に DOM要素をハイライトするインタラクティブなオーバーレイ
- **要素タイプフィルター**: 要素タイプ（div、main、section、article、p等）による選択
- **複数要素選択**: 複数の要素を同時に選択可能
- **選択プレビュー**: 実行前に選択した要素を視覚的に表示

### 2. リンクチェックエンジン
- **HTTP ステータス検証**: 200、404、301、302等のリンクチェック
- **応答時間追跡**: リンクの応答時間を監視
- **並行処理**: 複数のリンクを同時にチェックして高速化
- **カスタムタイムアウト設定**: 応答の遅いリンクに対する設定可能なタイムアウト

### 3. 結果表示
- **色分けされたリンク**:
  - 緑: 有効なリンク（200 OK）
  - 赤: 破損したリンク（404、500等）
  - 黄: リダイレクト（301、302）
  - オレンジ: 警告（応答遅延、タイムアウト）
- **詳細ツールチップ**: ホバー時にHTTPステータスコードと応答時間を表示
- **結果サマリー**: チェックしたリンクの統計を表示

### 4. エクスポートとレポート
- **CSV エクスポート**: リンクURL、ステータスコード、応答時間を含む結果をエクスポート
- **JSON エクスポート**: 統合用の機械可読形式
- **クリップボードにコピー**: 破損したリンクを即座に操作するためのクイックコピー

## ユーザーインターフェース設計

### 1. メインポップアップインターフェース
```
┌─────────────────────────────┐
│ 🔗 リンクチェッカー Pro      │
├─────────────────────────────┤
│ [要素選択] [設定]            │
│                             │
│ ステータス: 準備完了         │
│ 選択済み: 0 要素            │
│                             │
│ [▶ リンクチェック開始]      │
│                             │
│ 最近の結果:                 │
│ • 15個有効、2個破損         │
│ • 最終チェック: 2分前       │
└─────────────────────────────┘
```

### 2. 要素選択モード
- **オーバーレイインターフェース**: 要素ハイライト機能付きの半透明オーバーレイ
- **選択パネル**: 選択した要素を表示するフローティングパネル
- **クイックフィルター**: 一般的な要素タイプ（main、article、div）用のボタン

### 3. 結果表示
- **ページ内ハイライト**: ウェブページ上のリンクを直接ハイライト
- **結果パネル**: リンクステータスの詳細な内訳
- **エクスポートオプション**: エクスポート機能への迅速なアクセス

## 技術アーキテクチャ

### 1. 拡張機能の構造
```
extension/
├── manifest.json
├── popup/
│   ├── popup.html
│   ├── popup.js
│   └── popup.css
├── content/
│   ├── content.js
│   ├── element-selector.js
│   ├── link-checker.js
│   └── results-display.js
├── background/
│   └── background.js
├── assets/
│   ├── icons/
│   └── styles/
└── lib/
    ├── utils.js
    └── http-checker.js
```

### 2. コアコンポーネント

#### 要素セレクター (content/element-selector.js)
- DOM探索と要素識別
- 視覚的ハイライトと選択インターフェース
- タイプと属性による要素フィルタリング
- 選択状態の管理

#### リンクチェッカー (content/link-checker.js)
- 選択した要素からのリンク抽出
- Fetch APIを使用したHTTPステータスチェック
- 並行リクエスト処理
- 進捗追跡とレポート

#### 結果表示 (content/results-display.js)
- ウェブページ上での視覚的フィードバック
- 結果の集約と統計
- エクスポート機能
- クリップボード統合

### 3. 通信フロー
```
ポップアップUI ←→ コンテンツスクリプト ←→ バックグラウンドスクリプト
     ↓                ↓                  ↓
  ユーザー入力 → DOM選択           → HTTPリクエスト
     ↓                ↓                  ↓
    設定        → リンク抽出        → ステータスチェック
     ↓                ↓                  ↓
    結果        → 視覚的フィードバック → データ保存
```

## 実装フェーズ

### フェーズ1: コア要素選択
- [ ] ホバー時の基本要素ハイライト
- [ ] 単一要素選択
- [ ] 選択した要素からの簡単なリンク抽出

### フェーズ2: 拡張選択機能
- [ ] 複数要素選択
- [ ] 要素タイプフィルタリング
- [ ] ページインタラクション間での選択の永続化

### フェーズ3: リンクチェックエンジン
- [ ] HTTPステータスチェック
- [ ] 並行リクエスト処理
- [ ] 進捗インジケーターとキャンセル機能

### フェーズ4: 結果とエクスポート
- [ ] 視覚的リンクハイライト
- [ ] 結果サマリーと統計
- [ ] CSV/JSONエクスポート機能

### フェーズ5: 仕上げと最適化
- [ ] パフォーマンス最適化
- [ ] エラーハンドリングとエッジケース
- [ ] ユーザー設定と設定項目

## 技術的考慮事項

### 1. パフォーマンス
- **遅延読み込み**: リクエスト時のみリンクをチェック
- **リクエスト制限**: サーバーへの過負荷を避けるため並行リクエストを制限
- **キャッシュ**: 繰り返しチェックの結果をキャッシュ
- **メモリ管理**: チェック後のリソースクリーンアップ

### 2. セキュリティ
- **CSP準拠**: コンテンツセキュリティポリシーとの互換性確保
- **クロスオリジンリクエスト**: CORS制限の適切な処理
- **ユーザープライバシー**: データ収集や外部追跡なし

### 3. ブラウザ互換性
- **Chrome拡張機能 Manifest V3**: 最新の拡張機能APIを使用
- **モダンJavaScript**: 適切なフォールバック付きのES2020+機能
- **レスポンシブデザイン**: 異なる画面サイズのサポート

### 4. エラーハンドリング
- **ネットワーク障害**: オフラインシナリオの適切な処理
- **無効なURL**: 適切な検証とエラーメッセージ
- **権限エラー**: ブロックされたリクエストに対する明確なフィードバック

## 成功指標

1. **機能性**: 要素を正常に選択し、その中のリンクをチェック
2. **パフォーマンス**: 100以上のリンクを30秒以内にチェック
3. **精度**: 破損したリンクの識別で99%以上の精度
4. **使いやすさ**: 最小限のクリックで直感的な要素選択
5. **信頼性**: エッジケースとエラーの適切な処理

## 将来的な機能拡張

1. **バッチ処理**: 複数ページの順次チェック
2. **スケジュールチェック**: 自動定期リンク検証
3. **統合API**: 外部監視ツールとの接続
4. **高度なフィルタリング**: リンクパターン、ドメイン等によるフィルタリング
5. **履歴追跡**: 時間経過によるリンク健全性の追跡